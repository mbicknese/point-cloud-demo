<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Point cloud rendering demo</title>

		<link rel="stylesheet" href="//unpkg.com/open-props@1.7.4" />
		<link rel="stylesheet" href="//unpkg.com/open-props@1.7.4/normalize.min.css" />

		<style>
			body {
				height: 100dvh;
				padding: 0;
				background-image: url("/bg.svg");
				background-repeat: repeat;
				background-size: 15vw;
				background-color: var(--indigo-3);
			}
			@media (prefers-color-scheme: dark) {
				body {
					background-color: var(--indigo-9);
				}
			}

			footer {
				position: absolute;
				bottom: 0;
				padding: var(--size-2);
				color: var(--text-2);
			}

			canvas {
				position: absolute;
				z-index: 0;
				inset: 0;
				width: 100dvw;
				height: 100dvh;
			}
			main > *:not(canvas) {
				position: relative;
				z-index: 1;
			}
		</style>
	</head>

	<body>
		<main x-data="controls">
			<canvas id="glcanvas" @mouseDown="setActive"></canvas>

			<section>
				<h2>Controls</h2>
				<button type="button" @click="add">Add</button>
				<button type="button" @click="remove" x-bind:disabled="selected == null">Remove</button>
				<button type="button" @click="undo" x-bind:disabled="current === 0">Undo</button>
				<button type="button" @click="redo" x-bind:disabled="current === mutations.length">Redo</button>
				<label>
					Points
					<input type="file" accept=".pcd" @change="handleLoad" />
				</label>
				<template x-if="selected">
					<fieldset>
						<legend>Position</legend>
						<label>
							X
							<input
								type="range"
								min="-1"
								max="1"
								x-model="selected.position.x"
								@input="translate"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
						<label>
							Y
							<input
								type="range"
								min="-1"
								max="1"
								x-model="selected.position.y"
								@input="translate"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
						<label>
							Z
							<input
								type="range"
								min="-1"
								max="1"
								x-model="selected.position.z"
								@input="translate"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
					</fieldset>
				</template>
				<template x-if="selected">
					<fieldset>
						<legend>Rotation</legend>
						<label>
							X
							<input
								type="range"
								min="-1"
								max="1"
								x-model="selected.rotation.x"
								@input="rotate"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
						<label>
							Y
							<input
								type="range"
								min="-1"
								max="1"
								x-model="selected.rotation.y"
								@input="rotate"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
						<label>
							Z
							<input
								type="range"
								min="-1"
								max="1"
								x-model="selected.rotation.z"
								@input="rotate"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
					</fieldset>
				</template>
				<template x-if="selected">
					<fieldset>
						<legend>Scale</legend>
						<label>
							X
							<input
								type="range"
								min="0"
								max="2"
								x-model="selected.scale.x"
								@input="scale"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
						<label>
							Y
							<input
								type="range"
								min="0"
								max="2"
								x-model="selected.scale.y"
								@input="scale"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
						<label>
							Z
							<input
								type="range"
								min="0"
								max="2"
								x-model="selected.scale.z"
								@input="scale"
								@change="storeMutation"
								step="0.01"
							/>
						</label>
					</fieldset>
				</template>
			</section>
		</main>

		<footer>Made with â™¥ by Maarten Bicknese</footer>

		<script type="importmap">
			{
				"imports": {
					"three": "//unpkg.com/three@0.164.1/build/three.module.js"
				}
			}
		</script>
		<script src="/main.js" type="module"></script>
		<script
			src="//unpkg.com/alpinejs@3.13.10"
			defer
			integrity="sha512-dY1RrE1UTNd/Y4JdiPVn8EAb4rcAlPqYQNn2SSQdPP5sLfCDnvRS14gbYJnSRkc3DWiL7ggupu+bCw590rcXyg=="
			crossorigin="anonymous"
		></script>
	</body>
</html>
